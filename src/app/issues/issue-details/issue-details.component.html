<div class="min-h-screen bg-gradient-to-b from-background-light to-white dark:from-background-dark dark:to-card-dark pb-12">
  <!-- Toast Notifications -->
  @if (toastMessage) {
    <div class="fixed bottom-6 right-6 z-50 animate-slide-up">
      <div class="flex items-center gap-3 px-5 py-3 rounded-xl shadow-lg backdrop-blur-sm"
           [ngClass]="{
             'bg-success/90 text-white': toastType === 'success',
             'bg-danger/90 text-white': toastType === 'error',
             'bg-card-dark/90 text-white dark:bg-white/90 dark:text-black': toastType === 'info'
           }">
        <span class="material-symbols-outlined text-lg">
          {{ toastType === 'success' ? 'check_circle' : toastType === 'error' ? 'error' : 'info' }}
        </span>
        <span class="font-medium text-sm">{{ toastMessage }}</span>
      </div>
    </div>
  }

  @if (loading) {
    <div class="flex flex-col items-center justify-center py-24">
      <div class="relative">
        <div class="w-16 h-16 border-4 border-primary/20 rounded-full"></div>
        <div class="absolute top-0 left-0 w-16 h-16 border-4 border-transparent border-t-primary rounded-full animate-spin"></div>
      </div>
      <p class="mt-4 text-text-muted dark:text-gray-400 animate-pulse">Loading issue...</p>
    </div>
  } @else if (error) {
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="bg-white dark:bg-card-dark rounded-2xl shadow-soft p-8 text-center">
        <div class="w-16 h-16 mx-auto mb-4 bg-danger-light dark:bg-danger-dark/20 rounded-full flex items-center justify-center">
          <span class="material-symbols-outlined text-3xl text-danger">error_outline</span>
        </div>
        <p class="text-text-main dark:text-white font-medium mb-2">Issue not found</p>
        <p class="text-text-muted dark:text-gray-400">{{ error }}</p>
      </div>
    </div>
  } @else if (issue) {
    <!-- Compact Sticky Navigation -->
    <div class="bg-white/95 dark:bg-card-dark/95 backdrop-blur-md border-b border-gray-100 dark:border-white/5 sticky top-0 z-10">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <div class="flex items-center justify-between">
          <nav class="flex items-center gap-2 text-sm">
            <a
              routerLink="/issues"
              class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-text-muted dark:text-gray-400 hover:text-primary dark:hover:text-primary hover:bg-primary/5 transition-all group"
            >
              <span class="material-symbols-outlined text-lg group-hover:-translate-x-1 transition-transform">arrow_back</span>
              <span class="font-medium hidden sm:inline">Issues</span>
            </a>
            <span class="text-text-muted/40 dark:text-gray-600 hidden sm:inline">/</span>
            <span class="text-text-main dark:text-white font-medium truncate max-w-[200px] hidden sm:inline">{{ issue.title }}</span>
          </nav>

          <div class="flex items-center gap-2">
            <app-language-badge [language]="issue.language"></app-language-badge>
            <app-resolved-badge [isResolved]="issue.is_resolved"></app-resolved-badge>
          </div>
        </div>
      </div>
    </div>

    <!-- Issue Content Card -->
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <article class="bg-white dark:bg-card-dark rounded-2xl shadow-soft overflow-hidden">
        <!-- Author Header -->
        <div class="p-6 pb-4">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center ring-2 ring-white dark:ring-card-dark shadow-sm">
              <span class="material-symbols-outlined text-primary text-xl">person</span>
            </div>
            <div>
              <span class="font-semibold text-text-main dark:text-white block text-lg">{{ issue.author?.username || 'Deleted User' }}</span>
              <div class="flex items-center gap-2 text-sm text-text-muted dark:text-gray-400">
                <span>{{ getRelativeTime(issue.created_at) }}</span>
              </div>
            </div>
          </div>

          <!-- Issue Content -->
          <h1 class="text-2xl sm:text-3xl font-bold text-text-main dark:text-white mb-4 leading-tight">
            {{ issue.title }}
          </h1>

          <div class="text-text-main dark:text-white text-lg leading-relaxed whitespace-pre-wrap">
            {{ issue.content }}
          </div>
        </div>

        <!-- Image (if exists) -->
        @if (issue.imageUrl) {
          <div class="relative overflow-hidden bg-gray-100 dark:bg-background-dark cursor-pointer" (click)="openImageModal(issue.imageUrl)">
            <img
              [src]="issue.imageUrl"
              alt="Issue image"
              class="w-full max-h-[500px] object-contain hover:scale-[1.01] transition-transform duration-300"
            />
          </div>
        }

        <!-- Stats & Actions -->
        <div class="p-6 pt-4 border-t border-gray-100 dark:border-white/5">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-4 text-sm text-text-muted dark:text-gray-400">
              <div class="flex items-center gap-1.5 px-3 py-1.5 bg-primary/5 dark:bg-primary/10 rounded-lg text-primary">
                <span class="material-symbols-outlined text-lg">lightbulb</span>
                <span class="font-medium">{{ issue.solutions_count }} {{ issue.solutions_count === 1 ? 'solution' : 'solutions' }}</span>
              </div>
            </div>

            @if (isAuthenticated) {
              <div class="flex items-center gap-2">
                <app-vote-buttons
                  [likesCount]="issue.likesCount"
                  [dislikesCount]="issue.dislikesCount"
                  (vote)="voteOnIssue($event)"
                ></app-vote-buttons>

                @if (isIssueOwner()) {
                  <div class="w-px h-6 bg-gray-200 dark:bg-white/10 mx-1"></div>
                  <a
                    [routerLink]="['/issues', issue.id, 'edit']"
                    class="p-2.5 rounded-xl hover:bg-gray-100 dark:hover:bg-white/5 transition-colors"
                    title="Edit Issue"
                  >
                    <span class="material-symbols-outlined text-text-main dark:text-white">edit</span>
                  </a>
                  <button
                    (click)="confirmDeleteIssue()"
                    class="p-2.5 rounded-xl hover:bg-danger/10 transition-colors text-text-muted hover:text-danger"
                    title="Delete Issue"
                  >
                    <span class="material-symbols-outlined">delete</span>
                  </button>
                }
              </div>
            }
          </div>
        </div>
      </article>
    </div>

    <!-- Solutions Section -->
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-text-main dark:text-white flex items-center gap-2">
          <span class="material-symbols-outlined text-primary">lightbulb</span>
          Solutions
          <span class="text-lg text-text-muted font-normal">({{ solutions.length }})</span>
        </h2>
        @if (isAuthenticated && !showSolutionForm) {
          <button
            (click)="toggleSolutionForm()"
            class="flex items-center gap-2 px-5 py-2.5 bg-primary hover:bg-primary/90 text-black font-semibold rounded-xl shadow-soft hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5"
          >
            <span class="material-symbols-outlined">add_circle</span>
            Add Solution
          </button>
        }
      </div>

      <!-- Add Solution Form -->
      @if (showSolutionForm) {
        <div class="bg-white dark:bg-card-dark rounded-2xl shadow-soft p-6 mb-8">
          <h3 class="text-lg font-semibold text-text-main dark:text-white mb-6 flex items-center gap-2">
            <span class="material-symbols-outlined text-primary">edit_note</span>
            Add Your Solution
          </h3>

          @if (solutionError) {
            <div class="mb-6 p-4 bg-danger-light dark:bg-danger-dark/20 rounded-xl text-danger-dark dark:text-danger-light text-sm flex items-center gap-2">
              <span class="material-symbols-outlined">error</span>
              {{ solutionError }}
            </div>
          }

          <div class="space-y-6">
            <div>
              <label class="block text-sm font-semibold text-text-main dark:text-white mb-2">
                Solution Description <span class="text-text-muted font-normal">(Optional)</span>
              </label>
              <textarea
                [(ngModel)]="solutionTextContent"
                rows="4"
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark text-text-main dark:text-white focus:ring-0 focus:border-primary focus:bg-white dark:focus:bg-card-dark transition-all resize-none"
                placeholder="Explain your solution..."
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-semibold text-text-main dark:text-white mb-2">
                External Link <span class="text-text-muted font-normal">(Optional)</span>
              </label>
              <input
                type="url"
                [(ngModel)]="solutionExternalLink"
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark text-text-main dark:text-white focus:ring-0 focus:border-primary focus:bg-white dark:focus:bg-card-dark transition-all"
                placeholder="https://..."
              />
            </div>

            <!-- Image Upload for Solution -->
            <div>
              <label class="block text-sm font-semibold text-text-main dark:text-white mb-2">
                Attach Image <span class="text-text-muted font-normal">(Optional)</span>
              </label>
              @if (solutionImagePreview) {
                <div class="relative inline-block group">
                  <img
                    [src]="solutionImagePreview"
                    alt="Preview"
                    class="max-w-full max-h-48 rounded-xl border-2 border-gray-200 dark:border-white/10 shadow-soft"
                  />
                  <button
                    type="button"
                    (click)="removeSolutionImage()"
                    class="absolute top-3 right-3 p-2 bg-danger hover:bg-danger-dark text-white rounded-xl shadow-lg transition-all opacity-0 group-hover:opacity-100"
                    title="Remove image"
                  >
                    <span class="material-symbols-outlined text-sm">close</span>
                  </button>
                </div>
              } @else {
                <label
                  class="flex flex-col items-center justify-center w-full h-28 border-2 border-dashed border-gray-300 dark:border-white/20 rounded-xl cursor-pointer hover:border-primary hover:bg-primary/5 dark:hover:border-primary dark:hover:bg-primary/5 transition-all bg-gray-50 dark:bg-white/5"
                >
                  <div class="flex flex-col items-center justify-center py-2">
                    <span class="material-symbols-outlined text-2xl text-text-muted dark:text-gray-500 mb-1">add_photo_alternate</span>
                    <p class="text-xs text-text-muted dark:text-gray-400">Click to upload (max 2MB)</p>
                  </div>
                  <input
                    type="file"
                    class="hidden"
                    accept="image/*"
                    (change)="onSolutionImageSelected($event)"
                  />
                </label>
              }
            </div>

            <div class="flex gap-4 pt-2">
              <button
                (click)="submitSolution()"
                [disabled]="!isSolutionFormValid() || submittingSolution"
                class="px-6 py-3 bg-primary hover:bg-primary/90 text-black font-semibold rounded-xl shadow-soft hover:shadow-lg hover:shadow-primary/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
              >
                @if (submittingSolution) {
                  <span class="w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"></span>
                } @else {
                  <span class="material-symbols-outlined text-lg">send</span>
                }
                {{ submittingSolution ? 'Submitting...' : 'Submit Solution' }}
              </button>
              <button
                (click)="toggleSolutionForm()"
                [disabled]="submittingSolution"
                class="px-6 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-white/5 dark:hover:bg-white/10 text-text-main dark:text-white font-semibold rounded-xl transition-all hover:scale-[1.02] active:scale-[0.98]"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Solutions List -->
      @if (solutions.length === 0) {
        <div class="text-center py-16 bg-white dark:bg-card-dark rounded-2xl shadow-soft">
          <div class="w-20 h-20 mx-auto mb-6 bg-primary/10 rounded-2xl flex items-center justify-center">
            <span class="material-symbols-outlined text-5xl text-primary">lightbulb</span>
          </div>
          <h3 class="text-2xl font-bold text-text-main dark:text-white mb-2">No solutions yet</h3>
          <p class="text-text-muted dark:text-gray-400 max-w-md mx-auto">Be the first to help solve this issue!</p>
        </div>
      } @else {
        <div class="space-y-5">
          @for (solution of solutions; track solution.id) {
            <article
              class="bg-white dark:bg-card-dark rounded-2xl shadow-soft transition-shadow duration-200 hover:shadow-lg"
              [ngClass]="{
                'ring-2 ring-primary': solution.isAccepted
              }">

              <!-- Accepted Banner -->
              @if (solution.isAccepted) {
                <div class="bg-gradient-to-r from-primary/10 to-primary/5 px-6 py-3 flex items-center gap-2 border-b border-primary/20">
                  <app-accepted-badge></app-accepted-badge>
                  <span class="text-xs text-success font-medium">This solution solved the issue</span>
                </div>
              }

              <!-- Solution Header -->
              <div class="p-6 pb-0">
                <div class="flex items-start justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center ring-2 ring-white dark:ring-card-dark shadow-sm">
                      <span class="material-symbols-outlined text-primary text-lg">person</span>
                    </div>
                    <div>
                      <span class="font-semibold text-text-main dark:text-white block">{{ solution.contributor?.username || 'Unknown' }}</span>
                      <span class="text-xs text-text-muted dark:text-gray-400">
                        {{ getRelativeTime(solution.createdAt) }}
                        @if (solution.updatedAt !== solution.createdAt) {
                          · <span class="italic">edited</span>
                        }
                      </span>
                    </div>
                  </div>

                  <div class="flex items-center gap-1">
                    @if (isAuthenticated) {
                      <div class="relative" (click)="$event.stopPropagation()">
                        <button
                          type="button"
                          class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-gray-200 dark:border-white/10 hover:bg-gray-100 dark:hover:bg-white/5 transition-colors"
                          (click)="toggleSaveSolutionMenu(solution.id, $event)"
                          aria-label="Save solution">
                          <span class="material-symbols-outlined">bookmark_add</span>
                        </button>

                        @if (saveMenuOpenSolutionId === solution.id) {
                          <div class="absolute right-0 mt-2 w-64 rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-card-dark shadow-soft overflow-hidden z-10">
                            <button
                              type="button"
                              class="w-full flex items-center gap-3 px-4 py-3 text-sm font-semibold text-text-main dark:text-white hover:bg-background-light dark:hover:bg-white/5 transition-colors disabled:opacity-60 disabled:cursor-not-allowed"
                              [disabled]="savingToCollection"
                              (click)="saveSolutionToDefaultCollection(solution.id)">
                              <span class="material-symbols-outlined text-xl">bookmark</span>
                              <span>Save</span>
                            </button>

                            <div class="px-4 py-2 text-xs font-bold text-text-muted dark:text-gray-400 bg-background-light/40 dark:bg-white/5">
                              Save to collection
                            </div>

                            @if (collectionsLoading) {
                              <div class="px-4 py-3 text-sm text-text-muted dark:text-gray-400 flex items-center gap-2">
                                <span class="material-symbols-outlined animate-spin">progress_activity</span>
                                <span>Loading…</span>
                              </div>
                            } @else {
                              <div class="max-h-60 overflow-auto">
                                @for (col of collections; track col.id) {
                                  <button
                                    type="button"
                                    class="w-full text-left flex items-center gap-3 px-4 py-3 text-sm font-semibold text-text-main dark:text-white hover:bg-background-light dark:hover:bg-white/5 transition-colors disabled:opacity-60 disabled:cursor-not-allowed"
                                    [disabled]="savingToCollection"
                                    (click)="saveSolutionToCollection(solution.id, col.id)">
                                    <span class="material-symbols-outlined text-xl">folder</span>
                                    <span class="truncate">{{ col.name }}</span>
                                  </button>
                                }

                                @if (collections.length === 0) {
                                  <div class="px-4 py-3 text-sm text-text-muted dark:text-gray-400">
                                    No collections yet.
                                  </div>
                                }
                              </div>
                            }
                          </div>
                        }
                      </div>
                    }
                    @if (isAuthenticated && !solution.isAccepted) {
                      @if (canAcceptSolution()) {
                        <button
                          (click)="acceptSolution(solution.id)"
                          [disabled]="acceptingSolutionId === solution.id"
                          class="px-4 py-2 bg-success/10 hover:bg-success/20 text-success border border-success/50 hover:border-success rounded-xl transition-all text-sm font-semibold flex items-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed"
                        >
                          @if (acceptingSolutionId === solution.id) {
                            <span class="w-4 h-4 border-2 border-success/30 border-t-success rounded-full animate-spin"></span>
                          } @else {
                            <span class="material-symbols-outlined text-lg">check_circle</span>
                          }
                          Accept
                        </button>
                      }
                      @if (canEditSolution(solution) && editingSolutionId !== solution.id) {
                        <button
                          (click)="startEditSolution(solution)"
                          class="p-2.5 rounded-xl hover:bg-gray-100 dark:hover:bg-white/5 transition-colors"
                          title="Edit"
                        >
                          <span class="material-symbols-outlined text-text-muted hover:text-text-main dark:hover:text-white">edit</span>
                        </button>
                      }
                      @if (isSolutionOwner(solution) && !solution.isAccepted) {
                        <button
                          (click)="confirmDeleteSolution(solution.id)"
                          class="p-2.5 rounded-xl hover:bg-danger/10 transition-colors"
                          title="Delete"
                        >
                          <span class="material-symbols-outlined text-text-muted hover:text-danger">delete</span>
                        </button>
                      }
                    }
                  </div>
                </div>
              </div>

              <!-- Solution Content -->
              @if (editingSolutionId === solution.id) {
                <div class="p-6 space-y-4">
                  <textarea
                    [(ngModel)]="editSolutionTextContent"
                    rows="4"
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark text-text-main dark:text-white focus:ring-0 focus:border-primary transition-all resize-none"
                    placeholder="Solution content..."
                  ></textarea>
                  <input
                    type="url"
                    [(ngModel)]="editSolutionExternalLink"
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark text-text-main dark:text-white focus:ring-0 focus:border-primary transition-all"
                    placeholder="External link (optional)"
                  />
                  <div class="flex gap-3">
                    <button
                      (click)="submitEditSolution()"
                      class="px-5 py-2.5 bg-primary hover:bg-primary/90 text-black font-semibold rounded-xl transition-colors text-sm"
                    >
                      Save Changes
                    </button>
                    <button
                      (click)="cancelEditSolution()"
                      class="px-5 py-2.5 bg-gray-100 hover:bg-gray-200 dark:bg-white/5 dark:hover:bg-white/10 text-text-main dark:text-white font-semibold rounded-xl transition-colors text-sm"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              } @else {
                <!-- Text Content -->
                @if (solution.textContent) {
                  <div class="px-6 py-4">
                    <p class="text-text-main dark:text-white whitespace-pre-wrap leading-relaxed">
                      {{ solution.textContent }}
                    </p>
                  </div>
                }

                <!-- External Link -->
                @if (solution.externalLink) {
                  <div class="px-6 pb-4">
                    <a
                      [href]="solution.externalLink"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="inline-flex items-center gap-2 px-4 py-2.5 text-primary hover:text-primary/80 bg-primary/5 hover:bg-primary/10 rounded-xl transition-colors text-sm font-medium"
                    >
                      <span class="material-symbols-outlined text-lg">link</span>
                      <span>View External Resource</span>
                      <span class="material-symbols-outlined text-lg">open_in_new</span>
                    </a>
                  </div>
                }

                <!-- Image -->
                @if (solution.imageUrl) {
                  <div class="relative overflow-hidden bg-gray-100 dark:bg-background-dark cursor-pointer" (click)="openImageModal(solution.imageUrl)">
                    <img
                      [src]="solution.imageUrl"
                      alt="Solution image"
                      class="w-full max-h-96 object-contain hover:scale-[1.01] transition-transform duration-300"
                    />
                  </div>
                }
              }

              <!-- Solution Stats -->
              @if (isAuthenticated) {
                <div class="px-6 py-4 border-t border-gray-100 dark:border-white/5">
                  <div class="flex items-center justify-between">
                    <app-vote-buttons
                      [likesCount]="solution.likesCount"
                      [dislikesCount]="solution.dislikesCount"
                      (vote)="voteOnSolution(solution, $event)"
                    ></app-vote-buttons>
                    <button
                      (click)="toggleComments(solution.id)"
                      class="flex items-center gap-1.5 text-sm text-text-muted dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors px-3 py-2 rounded-xl hover:bg-primary/5"
                    >
                      <span class="material-symbols-outlined text-lg">chat_bubble_outline</span>
                      <span>{{ solution.commentsCount }} {{ solution.commentsCount === 1 ? 'comment' : 'comments' }}</span>
                    </button>
                  </div>
                </div>
              }

              <!-- Comments Section -->
              @if (showCommentsFor === solution.id) {
                <div class="px-6 py-4 border-t border-gray-100 dark:border-white/5 animate-fade-in bg-gray-50/50 dark:bg-background-dark/50">
                  <h4 class="text-sm font-semibold text-text-main dark:text-white mb-4 flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg text-primary">forum</span>
                    Discussion
                  </h4>

                  <!-- Add Comment Form -->
                  @if (isAuthenticated) {
                    <div class="mb-5 bg-gray-50 dark:bg-background-dark rounded-xl p-4">
                      <textarea
                        #commentTextarea
                        rows="3"
                        placeholder="Share your thoughts..."
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-white/10 bg-white dark:bg-card-dark text-text-main dark:text-white focus:ring-0 focus:border-primary transition-all text-sm resize-none"
                      ></textarea>
                      <div class="flex justify-end mt-3">
                        <button
                          type="button"
                          (click)="submitCommentFromTextarea(solution.id, commentTextarea)"
                          [disabled]="submittingComment[solution.id]"
                          class="px-5 py-2.5 bg-primary hover:bg-primary/90 text-black font-semibold rounded-xl transition-all text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 hover:shadow-lg hover:shadow-primary/20"
                        >
                          @if (submittingComment[solution.id]) {
                            <span class="w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"></span>
                          } @else {
                            <span class="material-symbols-outlined text-lg">send</span>
                          }
                          {{ submittingComment[solution.id] ? 'Posting...' : 'Post Comment' }}
                        </button>
                      </div>
                    </div>
                  }

                  <!-- Comments List -->
                  <div class="space-y-3">
                    @if (!solutionComments[solution.id]) {
                      <div class="flex justify-center py-6">
                        <div class="w-6 h-6 border-2 border-primary/30 border-t-primary rounded-full animate-spin"></div>
                      </div>
                    } @else if (solutionComments[solution.id].length === 0) {
                      <div class="text-center py-6">
                        <span class="material-symbols-outlined text-3xl text-text-muted/50 dark:text-gray-600 mb-2">chat_bubble_outline</span>
                        <p class="text-sm text-text-muted dark:text-gray-400">
                          No comments yet. Be the first to share your thoughts!
                        </p>
                      </div>
                    } @else {
                      @for (comment of solutionComments[solution.id]; track comment.id) {
                        <div class="bg-gray-50 dark:bg-background-dark rounded-xl p-4 transition-all hover:bg-gray-100 dark:hover:bg-background-dark/80">
                          <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center gap-2 text-sm">
                              <div class="w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary text-xs">person</span>
                              </div>
                              <span class="font-semibold text-text-main dark:text-white">
                                {{ comment.user.username }}
                              </span>
                              <span class="text-text-muted/40 dark:text-gray-600">·</span>
                              <span class="text-text-muted dark:text-gray-400 text-xs">
                                {{ getRelativeTime(comment.createdAt) }}
                              </span>
                            </div>
                            @if (isCommentOwner(comment)) {
                              <button
                                (click)="deleteComment(solution.id, comment.id)"
                                class="p-1.5 rounded-lg hover:bg-danger/10 transition-colors text-text-muted hover:text-danger"
                                title="Delete comment"
                              >
                                <span class="material-symbols-outlined text-sm">delete</span>
                              </button>
                            }
                          </div>
                          <p class="text-sm text-text-main dark:text-white whitespace-pre-wrap leading-relaxed pl-8">
                            {{ comment.content }}
                          </p>
                        </div>
                      }
                    }
                  </div>
                </div>
              }
            </article>
          }
        </div>
      }
    </div>
  }

  <!-- Delete Issue Dialog -->
  <app-confirm-dialog
    [isOpen]="showDeleteIssueDialog"
    title="Delete Issue?"
    message="This action cannot be undone. All solutions will also be deleted."
    confirmText="Delete"
    (confirm)="deleteIssue()"
    (cancel)="showDeleteIssueDialog = false"
  ></app-confirm-dialog>

  <!-- Delete Solution Dialog -->
  <app-confirm-dialog
    [isOpen]="showDeleteSolutionDialog"
    title="Delete Solution?"
    message="This action cannot be undone."
    confirmText="Delete"
    (confirm)="deleteSolution()"
    (cancel)="showDeleteSolutionDialog = false; deletingSolutionId = null"
  ></app-confirm-dialog>

  <!-- Image Modal -->
  @if (showImageModal && selectedImageUrl) {
    <div
      class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-fade-in"
      (click)="closeImageModal()"
    >
      <div class="relative max-w-[90vw] max-h-[90vh] animate-slide-up">
        <img
          [src]="selectedImageUrl"
          alt="Full size image"
          class="max-w-full max-h-[90vh] rounded-2xl shadow-2xl"
          (click)="$event.stopPropagation()"
        />
        <button
          (click)="closeImageModal()"
          class="absolute -top-3 -right-3 p-2.5 bg-white dark:bg-card-dark hover:bg-gray-100 dark:hover:bg-white/10 text-text-main dark:text-white rounded-full transition-all shadow-lg hover:scale-110"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
  }
</div>
