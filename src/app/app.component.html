@if (isAuthRoute) {
  <router-outlet></router-outlet>
} @else {
  <div class="h-screen overflow-hidden bg-background-light dark:bg-background-dark" (click)="profileMenuOpen = false">
    <div class="flex h-full">
      <!-- Left menu -->
      <aside class="w-72 shrink-0 border-r border-gray-200/60 dark:border-white/10 bg-background-light dark:bg-background-dark">
        <div class="h-full px-4 py-6">
          <a routerLink="/" class="flex items-center gap-3 text-text-main dark:text-white">
            <div class="bg-primary p-2 rounded-xl text-black">
              <span class="material-symbols-outlined text-2xl">code</span>
            </div>
            <h2 class="text-xl font-bold tracking-tight">Snip-it</h2>
          </a>

          @if (isLoggedIn()) {
            <nav class="mt-8 space-y-2" aria-label="Main">
              <a
                routerLink="/"
                [routerLinkActiveOptions]="{ exact: true }"
                routerLinkActive="bg-white/70 dark:bg-white/10 text-text-main dark:text-white"
                class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-semibold text-text-muted hover:bg-white/50 dark:hover:bg-white/10 hover:text-text-main dark:hover:text-white transition-colors"
              >
                <span class="material-symbols-outlined text-xl">dynamic_feed</span>
                <span>Feed</span>
              </a>

              <a
                routerLink="/issues"
                routerLinkActive="bg-white/70 dark:bg-white/10 text-text-main dark:text-white"
                class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-semibold text-text-muted hover:bg-white/50 dark:hover:bg-white/10 hover:text-text-main dark:hover:text-white transition-colors"
              >
                <span class="material-symbols-outlined text-xl">bug_report</span>
                <span>Issues</span>
              </a>

              <a
                routerLink="/collections"
                routerLinkActive="bg-white/70 dark:bg-white/10 text-text-main dark:text-white"
                class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-semibold text-text-muted hover:bg-white/50 dark:hover:bg-white/10 hover:text-text-main dark:hover:text-white transition-colors"
              >
                <span class="material-symbols-outlined text-xl">bookmark</span>
                <span>Saves</span>
              </a>

              <a
                routerLink="/snippets"
                routerLinkActive="bg-white/70 dark:bg-white/10 text-text-main dark:text-white"
                class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-semibold text-text-muted hover:bg-white/50 dark:hover:bg-white/10 hover:text-text-main dark:hover:text-white transition-colors"
              >
                <span class="material-symbols-outlined text-xl">lock</span>
                <span>Private Snippets</span>
              </a>

              @if (userId()) {
                <a
                  [routerLink]="['/profile', userId()]"
                  routerLinkActive="bg-white/70 dark:bg-white/10 text-text-main dark:text-white"
                  class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-semibold text-text-muted hover:bg-white/50 dark:hover:bg-white/10 hover:text-text-main dark:hover:text-white transition-colors"
                >
                  <span class="material-symbols-outlined text-xl">person</span>
                  <span>Profile</span>
                </a>
              }
            </nav>
          } @else {
            <div class="mt-8 space-y-3">
              <a
                routerLink="/login"
                routerLinkActive="bg-white/70 dark:bg-white/10"
                class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-semibold text-text-muted hover:bg-white/50 dark:hover:bg-white/10 hover:text-text-main dark:hover:text-white transition-colors"
              >
                <span class="material-symbols-outlined text-xl">login</span>
                <span>Log in</span>
              </a>
              <a
                routerLink="/signup"
                routerLinkActive="bg-primary text-black"
                class="flex items-center gap-3 rounded-xl px-4 py-3 text-base font-bold bg-primary text-black transition-colors"
              >
                <span class="material-symbols-outlined text-xl">person_add</span>
                <span>Sign up</span>
              </a>
            </div>
          }
        </div>
      </aside>

      <!-- Right side: top navbar + page content -->
      <div class="min-w-0 flex-1 flex flex-col min-h-0 overflow-hidden">
        <!-- Top navbar -->
        <header class="h-16 shrink-0 bg-background-light dark:bg-background-dark">
          <div class="h-full px-6 flex items-center gap-4">
            <div class="flex-1 flex justify-center">
              <div class="relative w-full max-w-xl">
                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted">search</span>
                <input
                  type="text"
                  placeholder="Search..."
                  class="w-full pl-10 pr-4 py-2.5 rounded-xl border-2 border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 text-text-main dark:text-white placeholder-text-muted focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all"
                />
              </div>
            </div>

            @if (isLoggedIn()) {
              <div class="relative" (click)="$event.stopPropagation()">
                <button
                  type="button"
                  (click)="toggleProfileMenu()"
                  class="flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-white/50 dark:hover:bg-white/10 transition-colors"
                >
                  <div class="w-9 h-9 rounded-full bg-primary text-black flex items-center justify-center font-bold uppercase">
                    {{ (username() || 'U').slice(0, 1) }}
                  </div>
                  <span class="hidden sm:block text-sm font-semibold text-text-main dark:text-white max-w-[12rem] truncate">
                    {{ username() }}
                  </span>
                  <span class="material-symbols-outlined text-text-muted">expand_more</span>
                </button>

                @if (profileMenuOpen) {
                  <div class="absolute right-0 mt-2 w-44 rounded-xl border border-gray-200/60 dark:border-white/10 bg-white dark:bg-card-dark shadow-soft overflow-hidden z-50">
                    <a
                      [routerLink]="['/profile', userId()]"
                      class="flex items-center gap-3 px-4 py-3 text-sm font-semibold text-text-main dark:text-white hover:bg-background-light dark:hover:bg-white/5 transition-colors"
                      (click)="profileMenuOpen = false"
                    >
                      <span class="material-symbols-outlined text-xl">person</span>
                      <span>Profile</span>
                    </a>
                    <button
                      type="button"
                      (click)="handleLogout(); profileMenuOpen = false"
                      class="w-full flex items-center gap-3 px-4 py-3 text-sm font-semibold text-text-main dark:text-white hover:bg-background-light dark:hover:bg-white/5 transition-colors"
                    >
                      <span class="material-symbols-outlined text-xl">logout</span>
                      <span>Logout</span>
                    </button>
                  </div>
                }
              </div>
            }
          </div>
        </header>

        <!-- Page content --> 
        <main class="min-w-0 flex-1 overflow-y-auto">
          <router-outlet></router-outlet>
        </main>
      </div>
    </div>
  </div>
}
