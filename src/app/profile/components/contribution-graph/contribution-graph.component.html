<div class="group w-full bg-white dark:bg-card-dark p-4 rounded-xl shadow-soft flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="bg-green-100 dark:bg-green-900/30 text-green-600 p-2 rounded-lg">
      <span class="material-symbols-outlined">dataset</span>
    </div>
    <div class="flex flex-col">
      <span class="font-bold text-sm">Contribution Graph</span>
      <span class="text-xs text-text-muted">Heatmap for the past year</span>
    </div>
  </div>
  <button class="text-xs font-bold px-3 py-1 rounded-full bg-primary text-black" (click)="view.emit()">View</button>
</div>

<!-- Modal -->
@if (visible) {
  <div class="fixed inset-0 z-50 flex items-center justify-center px-4">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="close.emit()"></div>
    <div class="relative w-full max-w-4xl bg-white dark:bg-card-dark rounded-2xl shadow-2xl p-6 border border-white/10">
      <button class="absolute top-3 right-3 size-9 rounded-full bg-black/10 dark:bg-white/10 text-text-main dark:text-white flex items-center justify-center" (click)="close.emit()">
        <span class="material-symbols-outlined text-lg">close</span>
      </button>
      <div class="flex items-center justify-between mb-4 pr-10">
        <div class="flex items-center gap-2">
          <span class="material-symbols-outlined text-green-600">insights</span>
          <h3 class="font-bold text-lg text-text-main dark:text-white">Contribution Graph</h3>
        </div>
        @if (loading()) { <span class="text-xs text-text-muted">Loading...</span> }
      </div>

      @if (error()) {
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
          <p class="text-red-600 dark:text-red-300">{{ error() }}</p>
          <button class="mt-2 bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700" (click)="reload.emit()">Retry</button>
        </div>
      }

      @if (!loading() && !error() && graphWeeks().length === 0) {
        <p class="text-sm text-text-muted">No contributions yet.</p>
      }

      @if (graphWeeks().length > 0) {
        <div class="overflow-x-auto">
          <div class="flex gap-1 pb-2 min-w-[520px]">
            @for (week of graphWeeks(); track week[0].date) {
              <div class="flex flex-col gap-1">
                @for (day of week; track day.date) {
                  <div class="w-3 h-3 rounded-sm" [ngClass]="contributionColor(day.count)" [title]="formatDate(day.date) + ' â€¢ ' + day.count + ' contributions'"></div>
                }
              </div>
            }
          </div>
        </div>
        <div class="flex items-center gap-2 mt-3 text-xs text-text-muted">
          <span>Less</span>
          <div class="w-3 h-3 rounded-sm bg-gray-100 dark:bg-white/10"></div>
          <div class="w-3 h-3 rounded-sm bg-green-200 dark:bg-green-900/40"></div>
          <div class="w-3 h-3 rounded-sm bg-green-400 dark:bg-green-800/70"></div>
          <div class="w-3 h-3 rounded-sm bg-green-500 dark:bg-green-700"></div>
          <div class="w-3 h-3 rounded-sm bg-green-600 dark:bg-green-600"></div>
          <span>More</span>
        </div>
      }
    </div>
  </div>
}
