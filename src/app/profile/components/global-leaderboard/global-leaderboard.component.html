<div class="group w-full bg-white dark:bg-card-dark p-4 rounded-xl shadow-soft flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 p-2 rounded-lg">
      <span class="material-symbols-outlined">leaderboard</span>
    </div>
    <div class="flex flex-col">
      <span class="font-bold text-sm">Global Leaderboard</span>
      <span class="text-xs text-text-muted">Top creators by XP</span>
    </div>
  </div>
  <button class="text-xs font-bold px-3 py-1 rounded-full bg-primary text-black" (click)="view.emit()">View</button>
</div>

<div [hidden]="!visible">
  <div class="fixed inset-0 z-50 flex items-center justify-center px-4">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="close.emit()"></div>
    <div class="relative w-full max-w-3xl bg-white dark:bg-card-dark rounded-2xl shadow-2xl p-6 border border-white/10">
      <button class="absolute top-3 right-3 size-9 rounded-full bg-black/10 dark:bg-white/10 text-text-main dark:text-white flex items-center justify-center" (click)="close.emit()">
        <span class="material-symbols-outlined text-lg">close</span>
      </button>
      <div class="flex items-center justify-between mb-4 pr-10">
        <div class="flex items-center gap-2">
          <span class="material-symbols-outlined text-blue-600">leaderboard</span>
          <h3 class="font-bold text-lg text-text-main dark:text-white">Global Leaderboard</h3>
        </div>
        @if (loading) { <span class="text-xs text-text-muted">Loading...</span> }
      </div>

      @if (error) {
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
          <p class="text-red-600 dark:text-red-300">{{ error }}</p>
          <button class="mt-2 bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700" (click)="reload.emit()">Retry</button>
        </div>
      }

      @if (!loading && !error && (!leaderboard || leaderboard.length === 0)) {
        <p class="text-sm text-text-muted">No leaderboard entries yet.</p>
      }

      @if ((leaderboard?.length ?? 0) > 0) {
        <div class="flex flex-col gap-3 max-h-[60vh] overflow-y-auto pr-1">
          @for (user of leaderboard; track user.id) {
            <div class="flex items-center justify-between p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-200 dark:bg-white/10 flex items-center justify-center font-bold text-blue-800">{{ user.rank || '-' }}</div>
                <div class="flex flex-col">
                  <span class="font-bold text-text-main dark:text-white">{{ user.name }}</span>
                  <span class="text-xs text-text-muted">&#64;{{ user.username }}</span>
                </div>
              </div>
              <div class="text-right">
                <p class="text-sm font-bold text-text-main dark:text-white">{{ user.score }} XP</p>
                <p class="text-xs text-text-muted">Posts {{ user.postsCount || 0 }} â€¢ Issues {{ user.issuesCount || 0 }}</p>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
