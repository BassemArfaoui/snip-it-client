<div class="fixed inset-0 z-50 flex items-center justify-center px-4">
  <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" (click)="cancel.emit()"></div>
  <div class="relative w-full max-w-xl bg-white dark:bg-card-dark rounded-2xl shadow-2xl p-6 border border-white/10">
    <button class="absolute top-3 right-3 size-9 rounded-full bg-black/10 dark:bg-white/10 text-text-main dark:text-white flex items-center justify-center" (click)="cancel.emit()">
      <span class="material-symbols-outlined text-lg">close</span>
    </button>
    <h3 class="text-xl font-bold text-text-main dark:text-white mb-2 pr-10">Edit Profile</h3>
    <p class="text-sm text-text-muted mb-4">Update your public info. Leave fields blank to keep current values.</p>
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-4 pr-2">
      <div class="flex flex-col gap-1">
        <label class="text-sm font-bold text-text-main dark:text-white">Username</label>
        <input formControlName="username" type="text" class="w-full rounded-lg border border-gray-200 dark:border-white/10 bg-white dark:bg-slate-900 px-3 py-2 text-sm" placeholder="Your username" />
        @if (editForm.get('username')?.touched && editForm.get('username')?.invalid) {
          <span class="text-xs text-red-600">Username must be at least 3 characters.</span>
        }
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-sm font-bold text-text-main dark:text-white">Email</label>
        <input formControlName="email" type="email" class="w-full rounded-lg border border-gray-200 dark:border-white/10 bg-white dark:bg-slate-900 px-3 py-2 text-sm" placeholder="you@example.com" />
        @if (editForm.get('email')?.touched && editForm.get('email')?.invalid) {
          <span class="text-xs text-red-600">Enter a valid email.</span>
        }
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-sm font-bold text-text-main dark:text-white">Avatar Image</label>
        <input type="file" accept="image/*" (change)="onFileChange($event)" class="w-full text-sm" />
        @if (imagePreview) {
          <div class="mt-2 flex items-center gap-3">
            <img [src]="imagePreview" alt="Avatar preview" class="w-16 h-16 rounded-full object-cover border border-gray-200 dark:border-white/10" />
            <span class="text-xs text-text-muted">New avatar preview</span>
          </div>
        }
      </div>

      @if (editError) {
        <div class="text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg px-3 py-2">{{ editError }}</div>
      }
      @if (editSuccess) {
        <div class="text-sm text-green-700 bg-green-50 border border-green-200 rounded-lg px-3 py-2">{{ editSuccess }}</div>
      }

      <div class="flex items-center justify-end gap-3 pt-2">
        <button type="button" class="px-4 py-2 rounded-full bg-gray-100 dark:bg-white/10 text-sm font-bold" (click)="cancel.emit()">Cancel</button>
        <button type="submit" [disabled]="editLoading" class="px-5 py-2 rounded-full bg-primary text-black text-sm font-bold disabled:opacity-60">
          @if (editLoading) { Saving... } @else { Save Changes }
        </button>
      </div>
    </form>
  </div>
</div>
