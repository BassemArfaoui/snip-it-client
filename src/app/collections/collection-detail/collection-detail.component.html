<div class="min-h-screen bg-gradient-to-b from-background-light to-white dark:from-background-dark dark:to-card-dark">
  <!-- Header -->
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <!-- Back Button & Title -->
      <div class="flex items-center gap-4 mb-4">
        <button 
          (click)="goBack()"
          class="p-2 hover:bg-gray-100 dark:hover:bg-white/5 rounded-xl transition-colors border border-gray-100 dark:border-white/10 text-text-main dark:text-white">
          ← Back
        </button>
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-2">
            @if (collection()?.isPublic) {
              <span class="px-2 py-1 bg-success-light dark:bg-success/15 text-success text-xs rounded-full uppercase">
                Public Collection
              </span>
            }
            @if (!collection()?.isPublic) {
              <span class="px-2 py-1 bg-danger-light dark:bg-danger-dark/20 text-danger text-xs rounded-full uppercase">
                Private Collection
              </span>
            }
            <span class="text-text-muted dark:text-gray-400 text-sm">{{collection()?.updatedAt| timeAgo}}</span>
          </div>
          <h1 class="text-3xl font-bold text-text-main dark:text-white mb-1">{{ collection()?.name || 'Loading...' }}</h1>
        </div>
        <div class="flex gap-2">
          @if (isCollectionOwner()) {
            <button 
              (click)="openEditModal()"
              class="px-4 py-2 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors font-semibold shadow-soft text-text-main dark:text-white">
              <span class="material-symbols-outlined text-[18px] align-middle mr-1">edit</span>
              Edit
            </button>
            <button 
              (click)="shareCollection()"
              class="px-4 py-2 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors font-semibold shadow-soft text-text-main dark:text-white">
              Share
            </button>
          }
          <button 
            (click)="addNewItem()"
            class="px-4 py-2 bg-primary hover:bg-primary/90 text-black rounded-xl flex items-center gap-2 transition-colors font-semibold shadow-soft">
            <span class="text-xl">+</span>
            New Item
          </button>
        </div>
      </div>
      
      <!-- Tags -->
      <div class="flex gap-2 mb-4 flex-wrap">
        @for (tag of collectionTags(); track tag.id) {
          <span
            class="px-3 py-1 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 text-text-main dark:text-white text-sm rounded-full shadow-soft flex items-center gap-2"
            [ngStyle]="tag.color ? { 'background-color': tag.color } : null">
            #{{ tag.name }}
            @if (isCollectionOwner()) {
              <button
                (click)="removeTag($event, tag)"
                class="text-danger hover:text-danger/80">×</button>
            }
          </span>
        }
        @if (isCollectionOwner()) {
          <button (click)="openTagModal()" class="px-3 py-1 text-text-muted dark:text-gray-400 text-sm font-semibold hover:text-primary">+ Add Tag</button>
        }
      </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Left Column - Items List -->
      <div class="flex-1">
        <!-- Tabs & Filters -->
        <div class="mb-4">
          <div class="flex items-center gap-4 mb-4">
            @for (tab of tabs; track tab) {
              <div class="relative">
                <button
                  (click)="setTab(tab)"
                  [ngClass]="selectedTab() === tab ? 'text-text-main dark:text-white' : 'text-text-muted dark:text-gray-400'"
                  class="px-4 py-2 font-semibold transition-colors">
                  {{ tab }}
                </button>
                @if (selectedTab() === tab) {
                  <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-primary"></div>
                }
              </div>
            }
          </div>
          
          <div class="flex gap-3 flex-wrap">
            <!-- Search -->
            <input
              type="text"
              [ngModel]="searchQuery()"
              (ngModelChange)="searchQuery.set($event)"
              placeholder="Search collections, snippets..."
              class="flex-1 min-w-[240px] px-4 py-2.5 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 text-text-main dark:text-white placeholder:text-text-muted dark:placeholder:text-gray-500 shadow-soft">
            
            <!-- Language Filter -->
            <select 
              [ngModel]="selectedLanguage()"
              (ngModelChange)="setLanguage($event)"
              class="px-7 py-2.5 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 text-text-main dark:text-white shadow-soft">
              @for (lang of languages; track lang) {
                <option [value]="lang">{{ lang }}</option>
              }
            </select>
            
            <!-- Sort -->
            <select 
              [ngModel]="sortBy()"
              (ngModelChange)="setSortBy($event)"
              class="px-7 py-2.5 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 text-text-main dark:text-white shadow-soft">
              <option value="Latest First">Latest First</option>
              <option value="Oldest First">Oldest First</option>
              <option value="Pinned First">Pinned</option>
              <option value="Favorites">Favorites</option>
            </select>
          </div>
        </div>

        <!-- Error Message -->
        @if (error()) {
          <div class="mb-4 p-4 bg-danger-light dark:bg-danger-dark/20 border border-danger/30 dark:border-danger/40 rounded-xl text-danger">
            {{ error() }}
          </div>
        }
        
        <!-- Loading -->
        @if (loading()) {
          <div class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
          </div>
        }
        
        <!-- Items List -->
        @if (!loading()) {
          <div class="space-y-3">
            <!-- Item Card -->
            @for (item of items(); track item.id) {
              <div
                (click)="openItem(item)"
                class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl p-4 hover:border-primary cursor-pointer transition-all group shadow-soft">
                
                <div class="flex items-start gap-4">
                  <!-- Icon -->
                  <span class="material-symbols-outlined text-[28px] text-primary">{{ getItemIcon(item.targetType) }}</span>
                  
                  <!-- Content -->
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start gap-2 mb-2">
                      <h3 class="font-semibold flex-1 line-clamp-1">
                        {{ item.target?.title || 'Untitled' }}
                      </h3>
                      <button 
                        (click)="togglePin($event, item)"
                        class="opacity-0 group-hover:opacity-100 transition-opacity"
                        title="Toggle pin">
                        <span
                          class="material-symbols-outlined text-[20px]"
                          [class.filled-icon]="item.isPinned"
                          [ngClass]="item.isPinned ? 'text-warning' : 'text-text-muted dark:text-gray-500'">push_pin</span>
                      </button>
                      <button 
                        (click)="toggleFavorite($event, item)"
                        class="opacity-0 group-hover:opacity-100 transition-opacity"
                        title="Toggle favorite">
                        <span
                          class="material-symbols-outlined text-[20px]"
                          [class.filled-icon]="item.isFavorite"
                          [ngClass]="item.isFavorite ? 'text-warning' : 'text-text-muted dark:text-gray-500'">star</span>
                      </button>
                      <button 
                        (click)="openMoveModal($event, item)"
                        class="opacity-0 group-hover:opacity-100 transition-opacity text-text-muted dark:text-gray-500 hover:text-primary"
                        title="Move to another collection">
                        <span class="material-symbols-outlined text-[20px]">drive_file_move</span>
                      </button>
                      <button 
                        (click)="removeItem($event, item)"
                        class="opacity-0 group-hover:opacity-100 transition-opacity text-text-muted dark:text-gray-500 hover:text-danger"
                        title="Remove from collection">
                        <span class="material-symbols-outlined text-[20px]">remove_circle</span>
                      </button>
                    </div>
                    
                    <p class="text-sm text-text-muted dark:text-gray-400 mb-3 line-clamp-2">
                      {{ item.target?.description || item.target?.content?.substring(0, 150) || 'No description' }}
                    </p>
                    
                    <div class="flex items-center gap-4 text-sm text-text-muted dark:text-gray-400 flex-wrap">
                      <span [class]="getItemBadgeColor(item.targetType)" class="px-2 py-0.5 rounded text-xs font-semibold">
                        {{ item.targetType }}
                      </span>
                      @if (item.target?.language) {
                        <span class="flex items-center gap-1">
                          <span class="w-2 h-2 bg-primary rounded-full"></span>
                          {{ item.target?.language }}
                        </span>
                      }
                      <span>Updated {{ item.updatedAt | timeAgo }}</span>
                    </div>
                  </div>
                </div>
              </div>
            }
            
            <!-- Empty State -->
            @if (items().length === 0) {
              <div class="text-center py-12">
                <span class="material-symbols-outlined text-5xl mb-4 text-primary">inventory_2</span>
                <h3 class="text-lg font-semibold mb-2">No items in this collection</h3>
                <p class="text-text-muted dark:text-gray-400 mb-4">Start adding snippets, posts, or issues</p>
                <button 
                  (click)="addNewItem()"
                  class="px-4 py-2 bg-primary hover:bg-primary/90 text-black rounded-xl transition-colors font-semibold shadow-soft">
                  Add Item
                </button>
              </div>
            }
          </div>
        }
      </div>

      <!-- Right Sidebar -->
      <div class="w-full lg:w-80 space-y-4">
        <!-- Collaborators -->
        @if (isCollectionOwner()) {
          <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl p-4 shadow-soft">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold">Collaborators</h3>
              <button class="text-primary text-sm font-semibold hover:text-primary/80">Manage</button>
            </div>
            
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-sm text-black">
                  You
                </div>
                <div class="flex-1">
                  <div class="text-sm">{{ collection()?.owner?.username }}</div>
                  <div class="text-xs text-text-muted dark:text-gray-400">Owner</div>
                </div>
                <span class="px-2 py-0.5 bg-primary/20 text-black text-xs rounded-full">Admin</span>
              </div>
              
              <button class="w-full py-2 border border-gray-100 dark:border-white/10 rounded-xl hover:bg-gray-50 dark:hover:bg-white/5 transition-colors text-sm font-semibold bg-white dark:bg-card-dark text-text-main dark:text-white shadow-soft hover:border-primary">
                + Invite Collaborator
              </button>
            </div>
          </div>
        }
        
        <!-- Public Link -->
        @if (isCollectionOwner()) {
          <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl p-4 shadow-soft">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-semibold">Public Link</h3>
              <div class="flex items-center gap-2">
    <span class="text-xs text-text-muted dark:text-gray-400">{{ collection()?.isPublic ? 'On' : 'Off' }}</span>
    <button
      class="w-10 h-5 rounded-full relative shadow-inner transition-colors"
      [ngClass]="collection()?.isPublic ? 'bg-primary' : 'bg-gray-300 dark:bg-gray-600'"
    >
      <!-- Ball that moves left/right -->
      <div
        class="w-4 h-4 bg-white rounded-full absolute top-0.5 shadow-sm transition-transform"
        [ngClass]="collection()?.isPublic ? 'translate-x-6' : 'translate-x-0.5'"
      ></div>
    </button>
  </div>
            </div>
            <p class="text-xs text-text-muted dark:text-gray-400 mb-3">Anyone with this link can view this collection</p>
            <div class="flex gap-2">
              <input
                type="text"
                readonly
                value="devcoll.io/c/backend-api-24"
                class="flex-1 px-3 py-2 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded text-xs text-text-muted dark:text-gray-400">
              <button 
                (click)="shareCollection()"
                class="px-3 py-2 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/5 rounded transition-colors shadow-soft hover:border-primary">
                <span class="material-symbols-outlined text-[18px]">content_copy</span>
              </button>
            </div>

          <!-- Share Confirmation Modal -->
          @if (showShareConfirmModal()) {
            <div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
              <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl">
                <!-- Header -->
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-xl font-bold">Make Collection Public?</h3>
                  <button (click)="closeShareConfirmModal()" class="text-text-muted dark:text-gray-400 hover:text-primary text-lg">×</button>
                </div>

                <!-- Content -->
                <div class="space-y-4 mb-6">
                  <p class="text-text-main dark:text-white">
                    Your collection is currently <strong>private</strong>. To generate a share link, it needs to be made <strong>public</strong>.
                  </p>
                  <p class="text-sm text-text-muted dark:text-gray-400">
                    This will allow anyone with the share link to access your collection based on the permission level you set.
                  </p>
                </div>

                <!-- Actions -->
                <div class="flex gap-3">
                  <button
                    (click)="closeShareConfirmModal()"
                    class="flex-1 px-4 py-2.5 bg-white dark:bg-card-dark hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-gray-100 dark:border-white/10 font-semibold text-text-main dark:text-white">
                    Cancel
                  </button>
                  <button
                    (click)="confirmAndMakePublic()"
                    [disabled]="isGeneratingShareLink()"
                    class="flex-1 px-4 py-2.5 bg-primary hover:bg-primary/90 text-black rounded-xl transition-colors font-semibold shadow-soft disabled:opacity-50 disabled:cursor-not-allowed">
                    @if (isGeneratingShareLink()) {
                      <span class="inline-block animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-black/80"></span>
                    } @else {
                      Make Public & Share
                    }
                  </button>
                </div>
              </div>
            </div>
          }

          <!-- Move Item Modal -->
          @if (showMoveModal()) {
            <div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
              <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl">
                <!-- Header -->
                <div class="flex items-center justify-between mb-6">
                  <h3 class="text-xl font-bold">Move Item to Collection</h3>
                  <button (click)="closeMoveModal()" class="text-text-muted dark:text-gray-400 hover:text-primary text-lg">×</button>
                </div>

                <!-- Item Preview -->
                <div class="mb-4 p-3 bg-background-light dark:bg-white/5 border border-gray-100 dark:border-white/10 rounded-xl">
                  <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-[24px] text-primary">{{ getItemIcon(itemToMove()?.targetType || '') }}</span>
                    <div class="flex-1 min-w-0">
                      <div class="font-semibold text-sm line-clamp-1">
                        {{ itemToMove()?.target?.title || 'Untitled' }}
                      </div>
                      <div class="text-xs text-text-muted dark:text-gray-400">
                        {{ itemToMove()?.targetType }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Collection Selection -->
                <div class="space-y-3">
                  <label class="block text-sm font-semibold text-text-main dark:text-white mb-2">
                    Select destination collection
                  </label>

                  @if (loadingCollections()) {
                    <div class="text-center py-8">
                      <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"></div>
                    </div>
                  } @else {
                    <div class="max-h-64 overflow-y-auto space-y-2">
                      @if (userCollections().length === 0) {
                        <div class="text-center py-8 text-text-muted dark:text-gray-400">
                          <span class="material-symbols-outlined text-3xl mb-2 text-primary">inventory_2</span>
                          <p class="text-sm">No other collections available</p>
                        </div>
                      }
                      @for (col of userCollections(); track col.id) {
                        <button
                          (click)="destinationCollectionId.set(col.id)"
                          [ngClass]="destinationCollectionId() === col.id
                            ? 'border-primary bg-white dark:bg-white/5'
                            : 'border-gray-100 dark:border-white/10 bg-white dark:bg-card-dark'"
                          class="w-full p-3 border-2 rounded-xl hover:border-primary transition-all text-left">
                          <div class="flex items-center justify-between">
                            <div class="flex-1">
                              <div class="font-semibold text-sm">{{ col.name }}</div>
                              <div class="text-xs text-text-muted dark:text-gray-400 mt-1">
                                {{ col.itemCount || 0 }} items
                                @if (col.isPublic) {
                                  <span class="ml-1 px-1.5 py-0.5 bg-success-light dark:bg-success/15 text-success text-xs rounded">Public</span>
                                }
                              </div>
                            </div>
                            @if (destinationCollectionId() === col.id) {
                              <span class="material-symbols-outlined text-[18px] text-primary">check</span>
                            }
                          </div>
                        </button>
                      }
                    </div>
                  }
                </div>

                <!-- Actions -->
                <div class="flex gap-3 mt-6">
                  <button
                    (click)="closeMoveModal()"
                    class="flex-1 px-4 py-2.5 bg-white dark:bg-card-dark hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-gray-100 dark:border-white/10 font-semibold text-text-main dark:text-white">
                    Cancel
                  </button>
                  <button
                    (click)="moveItemToCollection()"
                    [disabled]="!destinationCollectionId()"
                    class="flex-1 px-4 py-2.5 bg-primary hover:bg-primary/90 text-black rounded-xl transition-colors font-semibold shadow-soft disabled:opacity-50 disabled:cursor-not-allowed">
                    Move Item
                  </button>
                </div>
              </div>
            </div>
          }

          <!-- Tag Modal -->
          @if (showTagModal()) {
            <div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
              <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-2xl p-6 max-w-2xl w-full shadow-2xl">
                <!-- Header -->
                <div class="flex items-center justify-between mb-6">
                  <h3 class="text-xl font-bold">
                    @if (tagModalStep() === 'select') {
                      Select or Create Tags
                    } @else {
                      Create New Tag
                    }
                  </h3>
                  <button (click)="closeTagModal()" class="text-text-muted dark:text-gray-400 hover:text-primary text-lg">×</button>
                </div>

                <!-- Page 1: Select Existing Tags -->
                @if (tagModalStep() === 'select') {
                  <div class="space-y-4">
                    <div>
                      <label class="block text-sm font-semibold text-text-main dark:text-white mb-3">Search and select from your existing tags</label>
                      <input
                        type="text"
                        [ngModel]="tagSearch()"
                        (ngModelChange)="tagSearch.set($event)"
                        placeholder="Search your tags..."
                        class="w-full px-4 py-2.5 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 text-text-main dark:text-white placeholder:text-text-muted dark:placeholder:text-gray-500 shadow-soft">
                    </div>

                    <!-- Tags List -->
                    <div class="flex flex-wrap gap-2 max-h-64 overflow-y-auto p-3 bg-background-light dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/10">
                      @if (filteredTags().length === 0) {
                        <div class="w-full text-center py-6 text-text-muted dark:text-gray-400">
                          @if (availableTags().length === 0) {
                            <span>No tags yet. Create your first tag</span>
                          } @else {
                            <span>All tags already assigned</span>
                          }
                        </div>
                      }
                      @for (tag of filteredTags(); track tag.id) {
                        <button
                          (click)="assignTag(tag)"
                          class="px-4 py-2 rounded-full border-2 border-gray-100 dark:border-white/10 hover:border-primary text-sm font-semibold text-text-main dark:text-white shadow-soft transition-all hover:scale-105 bg-white dark:bg-card-dark"
                          [ngStyle]="{ 'background-color': tag.color || null, 'border-color': tag.color ? 'transparent' : null }">
                          #{{ tag.name }}
                        </button>
                      }
                    </div>

                    <!-- Stats -->
                    <div class="flex items-center justify-between text-sm text-text-muted dark:text-gray-400">
                      <span>{{ collectionTags().length }} tags assigned</span>
                      <span>{{ filteredTags().length }} available</span>
                    </div>
                  </div>

                  <!-- Navigation -->
                  <div class="flex gap-3 mt-6">
                    <button
                      (click)="closeTagModal()"
                      class="flex-1 px-4 py-2.5 bg-white dark:bg-card-dark hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-gray-100 dark:border-white/10 font-semibold text-text-main dark:text-white">
                      Close
                    </button>
                    <button
                      (click)="goToCreateTagPage()"
                      class="flex-1 px-4 py-2.5 bg-primary hover:bg-primary/90 text-black rounded-xl transition-colors font-semibold shadow-soft">
                      Create New Tag →
                    </button>
                  </div>
                }

                <!-- Page 2: Create New Tag -->
                @if (tagModalStep() === 'create') {
                  <div class="space-y-5">
                    <div>
                      <label class="block text-sm font-semibold text-text-main dark:text-white mb-2">Tag Name</label>
                      <input
                        type="text"
                        [ngModel]="newTagName()"
                        (ngModelChange)="newTagName.set($event)"
                        placeholder="e.g., backend, design, important"
                        class="w-full px-4 py-2.5 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 text-text-main dark:text-white placeholder:text-text-muted dark:placeholder:text-gray-500 shadow-soft"
                        (keyup.enter)="createAndAssignTag()">
                    </div>

                    <div>
                      <label class="block text-sm font-semibold text-text-main dark:text-white mb-3">Choose Color</label>
                      <div class="flex items-center gap-4">
                        <input
                          type="color"
                          [ngModel]="newTagColor()"
                          (ngModelChange)="newTagColor.set($event)"
                          class="w-16 h-12 border-2 border-gray-100 dark:border-white/10 rounded-lg bg-white dark:bg-card-dark cursor-pointer">
                        <div
                          class="flex-1 h-12 rounded-lg border-2 border-gray-100 dark:border-white/10 flex items-center px-4 font-semibold text-text-main dark:text-white bg-white dark:bg-card-dark"
                          [ngStyle]="{ 'background-color': newTagColor() }">
                          Preview
                        </div>
                      </div>
                    </div>

                    <div class="bg-background-light dark:bg-white/5 border border-gray-100 dark:border-white/10 rounded-lg p-4">
                      <p class="text-sm text-text-main dark:text-white">
                        <strong>Tag will appear as:</strong><br>
                        <span
                          class="inline-block px-3 py-1 rounded-full mt-2 font-semibold text-text-main dark:text-white"
                          [ngStyle]="{ 'background-color': newTagColor() }">
                          #{{ newTagName() || 'tagname' }}
                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- Navigation -->
                  <div class="flex gap-3 mt-6">
                    <button
                      (click)="goBackToSelectPage()"
                      class="flex-1 px-4 py-2.5 bg-white dark:bg-card-dark hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-gray-100 dark:border-white/10 font-semibold text-text-main dark:text-white">
                      ← Back
                    </button>
                    <button
                      (click)="createAndAssignTag()"
                      [disabled]="!newTagName().trim()"
                      class="flex-1 px-4 py-2.5 bg-primary hover:bg-primary/90 text-black rounded-xl transition-colors font-semibold shadow-soft disabled:opacity-50 disabled:cursor-not-allowed">
                      Create & Add Tag
                    </button>
                  </div>
                }
              </div>
            </div>
          }
          <button 
          (click)="revokeShareLink()" 
          class="w-full mt-2 py-2 text-danger hover:bg-danger-light dark:hover:bg-danger-dark/20 rounded transition-colors text-sm font-semibold">
            Revoke access
          </button>
          </div>
        }
        
        <!-- Collection Stats -->
        <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl p-4 shadow-soft">
          <h3 class="font-semibold mb-4">Collection Stats</h3>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="text-2xl font-bold text-text-main dark:text-white">{{ stats().items }}</div>
              <div class="text-xs text-text-muted dark:text-gray-400">ITEMS</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-text-main dark:text-white">{{ stats().posts }}</div>
              <div class="text-xs text-text-muted dark:text-gray-400">POSTS</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-text-main dark:text-white">{{ stats().issues }}</div>
              <div class="text-xs text-text-muted dark:text-gray-400">ISSUES</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-text-main dark:text-white">{{ stats().solutions }}</div>
              <div class="text-xs text-text-muted dark:text-gray-400">SOLUTIONS</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Collection Modal -->
@if (showEditModal()) {
  <div class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-2xl p-6 max-w-md w-full shadow-2xl">
      <h2 class="text-xl font-bold mb-4">Edit Collection</h2>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm text-text-main dark:text-white mb-2">Collection Name</label>
          <input
            type="text"
            [ngModel]="editCollectionName()"
            (ngModelChange)="editCollectionName.set($event)"
            placeholder="e.g., React Hooks Patterns"
            class="w-full px-4 py-2 bg-white dark:bg-card-dark border border-gray-100 dark:border-white/10 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 text-text-main dark:text-white placeholder:text-text-muted dark:placeholder:text-gray-500 shadow-soft"
            (keyup.enter)="updateCollection()">
        </div>
        
        <div class="flex items-center gap-3">
          <input
            type="checkbox"
            id="editIsPublic"
            [ngModel]="editCollectionPublic()"
            (ngModelChange)="editCollectionPublic.set($event)"
            class="w-4 h-4 rounded border-gray-300 dark:border-white/10 text-primary focus:ring-primary">
          <label for="editIsPublic" class="text-sm text-text-main dark:text-white">Make this collection public</label>
        </div>
        
        <div class="flex items-center gap-3">
          <input
            type="checkbox"
            id="editAllowEdit"
            [ngModel]="editCollectionAllowEdit()"
            (ngModelChange)="editCollectionAllowEdit.set($event)"
            class="w-4 h-4 rounded border-gray-300 dark:border-white/10 text-primary focus:ring-primary">
          <label for="editAllowEdit" class="text-sm text-text-main dark:text-white">Allow others to edit</label>
        </div>
      </div>
      
      <div class="flex gap-3 mt-6">
        <button
          (click)="closeEditModal()"
          class="flex-1 px-4 py-2 bg-white dark:bg-card-dark hover:bg-gray-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-gray-100 dark:border-white/10 font-semibold text-text-main dark:text-white">
          Cancel
        </button>
        <button
          (click)="updateCollection()"
          [disabled]="!editCollectionName().trim()"
          class="flex-1 px-4 py-2 bg-primary hover:bg-primary/90 text-black rounded-xl transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-soft">
          Update
        </button>
      </div>
    </div>
  </div>
}
